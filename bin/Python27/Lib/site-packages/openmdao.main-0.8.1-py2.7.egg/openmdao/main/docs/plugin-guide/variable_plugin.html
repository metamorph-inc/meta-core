
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Building a Variable Plugin &mdash; OpenMDAO Documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.8.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="OpenMDAO Documentation" href="../index.html" />
    <link rel="up" title="Plugin Developer Guide" href="index.html" />
    <link rel="next" title="Building a Plugin that Contains a Python Extension" href="extension_plugin.html" />
    <link rel="prev" title="Building a Component Plugin" href="module_plugin.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="extension_plugin.html" title="Building a Plugin that Contains a Python Extension"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="module_plugin.html" title="Building a Component Plugin"
             accesskey="P">previous</a> |</li>
  <li><a href="http://openmdao.org">OpenMDAO Home</a> &raquo;</li>
  
        <li><a href="../index.html">OpenMDAO Documentation v0.8.1</a> &raquo;</li>

          <li><a href="index.html" accesskey="U">Plugin Developer Guide</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="building-a-variable-plugin">
<span id="id1"></span><h1>Building a Variable Plugin<a class="headerlink" href="#building-a-variable-plugin" title="Permalink to this headline">¶</a></h1>
<p>Sometimes it&#8217;s necessary to create a new type of variable that can be passed
between OpenMDAO components.  This section describes how to do this using a
pure Python OpenMDAO plugin.</p>
<p>Let&#8217;s assume we want to have a variable that represents a set of Cartesian
coordinates, with the value of the variable being a 3-tuple of floating point
values representing the <em>x, y,</em> and <em>z</em> position.</p>
<p>As before when we created a component plugin, we&#8217;ll use <tt class="docutils literal"><span class="pre">plugin</span> <span class="pre">quickstart</span></tt> to
generate the directory structure for our distribution, but this time we use
the <strong>-g</strong> option to specify the plugin group as <tt class="docutils literal"><span class="pre">openmdao.variable</span></tt>.
Also, this time around we&#8217;ll specify a class name of <em>Coordinates</em> using
the <strong>-c</strong> option.</p>
<div class="highlight-python"><pre>plugin quickstart coord -c Coordinates -g openmdao.variable</pre>
</div>
<p>Since we said our distribution name is going to be <em>coord</em>, that means that
<tt class="docutils literal"><span class="pre">plugin</span> <span class="pre">quickstart</span></tt> created a skeleton of our plugin class definition in
the <tt class="docutils literal"><span class="pre">src/coord/coord.py</span></tt> file.  After editing that file, it looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">openmdao.main.variable</span> <span class="kn">import</span> <span class="n">Variable</span>

<span class="k">class</span> <span class="nc">Coordinates</span><span class="p">(</span><span class="n">Variable</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_value</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">),</span> <span class="o">**</span><span class="n">metadata</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Coordinates</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">default_value</span><span class="o">=</span><span class="n">default_value</span><span class="p">,</span>
                                         <span class="o">**</span><span class="n">metadata</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> \
           <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">))</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<p>OpenMDAO provides a base class for framework visible inputs and outputs called
<cite>Variable</cite>, so that&#8217;s the base class for our coordinates variable. If a
Component object contains a Variable instance that has a metadata
attribute named <em>iotype</em> then that instance object is exposed to the framework
as a variable whose value can be passed between components. Valid values for
<em>iotype</em> are <tt class="docutils literal"><span class="pre">'in'</span></tt> and <tt class="docutils literal"><span class="pre">'out'</span></tt>.</p>
<p>One thing that can be a little confusing to people first using Variables is that
the Variable object itself is just a validator and possibly a converter. The
object that actually gets passed around between components is the <em>value</em> that
the variable corresponds to and not the variable itself. For example, if we had a
component named <em>wheel</em> that contained one of our Coordinates variables named
<tt class="docutils literal"><span class="pre">center_location</span></tt>, then the value of <tt class="docutils literal"><span class="pre">wheel.center_location</span></tt> would be a
3-tuple, not a Coordinates object.</p>
<p>We override the base class constructor so we can supply a default value of
(<tt class="docutils literal"><span class="pre">0.,0.,0.</span></tt>) if the caller doesn&#8217;t supply one. After that, the only function we
need to supply is the <tt class="docutils literal"><span class="pre">validate</span></tt> function, which will be called with the
following arguments:</p>
<dl class="docutils">
<dt><strong>object</strong></dt>
<dd>The object that contains the value of our coordinates variable</dd>
<dt><strong>name</strong></dt>
<dd>The name of our coordinates variable</dd>
<dt><strong>value</strong></dt>
<dd>The value that our current value is being replaced with</dd>
</dl>
<p>Our <tt class="docutils literal"><span class="pre">validate</span></tt> function should test that the value we&#8217;ve been called with is
valid. In this particular case, we just need to verify that the value is a
3-tuple and it has float or int entries. If the value is acceptable, then we
just return it. We don&#8217;t need to do it in this case, but in other custom
traits, we could convert the value before returning it. If the value
is not acceptable, then we call the <tt class="docutils literal"><span class="pre">error</span></tt> function, which will raise an
exception, typically a ValueError or a TypeError depending on the nature of
the error.</p>
<p>That&#8217;s all of the source code required to make our Coordinates variable
functional.  As in the earlier section, where we made a component plugin,
we need to specify the metadata for our distribution by editing the
<tt class="docutils literal"><span class="pre">setup.cfg</span></tt> file and add any extra documentation that we want to the
<tt class="docutils literal"><span class="pre">docs/usage.rst</span></tt> file and the <tt class="docutils literal"><span class="pre">README.txt</span></tt> file.  When that&#8217;s done,
as before, we run <tt class="docutils literal"><span class="pre">plugin</span> <span class="pre">makedist</span></tt>; the end result should be a
source distribution named <tt class="docutils literal"><span class="pre">coord-0.1.tar.gz</span></tt>.  The version id of our
plugin defaulted to <strong>0.1</strong> because we didn&#8217;t specify it when we ran
<tt class="docutils literal"><span class="pre">plugin</span> <span class="pre">quickstart</span></tt>.</p>
</div>
<div class="section" id="building-a-driver-plugin">
<h1>Building a Driver Plugin<a class="headerlink" href="#building-a-driver-plugin" title="Permalink to this headline">¶</a></h1>
<p>Drivers are Components that have some extra API functions to let them
deal with iterating over workflows, handling design variables, etc.
Driver plugins are built and distributed in the same way as component
plugins, so we can use the <tt class="docutils literal"><span class="pre">plugin</span> <span class="pre">quickstart</span></tt> command to create a
starting directory structure for our plugin:</p>
<div class="highlight-python"><pre>plugin quickstart mydriver -c MyDriver -g openmdao.driver</pre>
</div>
<p>By settng the <strong>-g</strong> option to <tt class="docutils literal"><span class="pre">openmdao.driver</span></tt>, we tell <tt class="docutils literal"><span class="pre">plugin</span> <span class="pre">quickstart</span></tt>
to generate a source file containing a Driver class.  The rest of the plugin
development process is the same as described in the <a class="reference internal" href="module_plugin.html#build-pure-python-plugin-label"><em>Building a Component Plugin</em></a>
section.</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<a href="http://openmdao.org">
 <img src="../_static/OpenMDAO_Logo_200w_padded.png"
border="0" alt="OpenMDAO Home"/>
</a>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Building a Variable Plugin</a></li>
<li><a class="reference internal" href="#building-a-driver-plugin">Building a Driver Plugin</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="module_plugin.html"
                        title="previous chapter">Building a Component Plugin</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="extension_plugin.html"
                        title="next chapter">Building a Plugin that Contains a Python Extension</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/plugin-guide/variable_plugin.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="extension_plugin.html" title="Building a Plugin that Contains a Python Extension"
             >next</a> |</li>
        <li class="right" >
          <a href="module_plugin.html" title="Building a Component Plugin"
             >previous</a> |</li>
  <li><a href="http://openmdao.org">OpenMDAO Home</a> &raquo;</li>
  
        <li><a href="../index.html">OpenMDAO Documentation v0.8.1</a> &raquo;</li>

          <li><a href="index.html" >Plugin Developer Guide</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright none.
      Last updated on Aug 26, 2013.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>