
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Building a Plugin that Contains a Python Extension &mdash; OpenMDAO Documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.8.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="OpenMDAO Documentation" href="../index.html" />
    <link rel="up" title="Plugin Developer Guide" href="index.html" />
    <link rel="next" title="Building a Plugin that Contains a File Wrapper" href="filewrapper_plugin.html" />
    <link rel="prev" title="Building a Variable Plugin" href="variable_plugin.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="filewrapper_plugin.html" title="Building a Plugin that Contains a File Wrapper"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="variable_plugin.html" title="Building a Variable Plugin"
             accesskey="P">previous</a> |</li>
  <li><a href="http://openmdao.org">OpenMDAO Home</a> &raquo;</li>
  
        <li><a href="../index.html">OpenMDAO Documentation v0.8.1</a> &raquo;</li>

          <li><a href="index.html" accesskey="U">Plugin Developer Guide</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <span class="target" id="index-0"></span><span class="target" id="index-1"></span><span class="target" id="index-2"></span><div class="section" id="building-a-plugin-that-contains-a-python-extension">
<span id="index-3"></span><h1>Building a Plugin that Contains a Python Extension<a class="headerlink" href="#building-a-plugin-that-contains-a-python-extension" title="Permalink to this headline">¶</a></h1>
<p>Many of you will have an existing application written in some language other than Python that
needs to be turned into an openMDAO component. This section and the one that follows present
some examples that show you how to do this. The process of building a Python extension to some
external code is called <em>wrapping.</em> There are generally two ways to wrap an application: direct
wrapping and file wrapping. In a <em>direct</em> wrap, data is passed directly into and out of the wrapped
function through memory, while in a <em>file</em> wrap intermediate data files
are used.</p>
<p>When to direct wrap:</p>
<ul class="simple">
<li>Source (or linkable library) is available</li>
<li>Source is a function that passes data as arguments (or through COMMON blocks)</li>
<li>Source can be easily modified to pass data as arguments (or through COMMON blocks)</li>
<li>Large amounts of data need to be passed (performance)</li>
<li>OpenMDAO component needs to be executed repeatedly (performance)</li>
</ul>
<p>When to file wrap:</p>
<ul class="simple">
<li>Source (or linkable library) is unavailable</li>
<li>Source passes data via file I/O</li>
<li>You don&#8217;t have the resources to modify a legacy code to pass data as arguments</li>
</ul>
<p>In general, a direct wrap should have better performance and should be less problematic, but
it is not always a viable option. To learn how to file-wrap in OpenMDAO, see
<a class="reference internal" href="filewrapper_plugin.html#building-a-plugin-using-a-file-wrapper"><em>Building a Plugin that Contains a File Wrapper</em></a>.</p>
<p>For the examples presented here, we assume that you are already familiar with the
fundamentals of the OpenMDAO component API and also with creating Python components
as outlined in the <a class="reference internal" href="../tutorials/complex/index.html#a-more-complex-tutorial-problem"><em>A More Complex Tutorial Problem</em></a>.</p>
<span class="target" id="index-4"></span><div class="section" id="creating-an-extension-with-f2py">
<span id="index-5"></span><span id="id1"></span><h2>Creating an Extension with F2PY<a class="headerlink" href="#creating-an-extension-with-f2py" title="Permalink to this headline">¶</a></h2>
<p>To support the integration of Fortran codes into Python, F2PY (Fortran to
Python Interface Generator) was developed. It is currently distributed as part
of the NumPy package for Python which is an OpenMDAO prerequisite. To use
F2PY, NumPy needs to be installed into the default Python environment on your
system.</p>
<div class="highlight-python"><pre>Wrapper Utility: F2PY
Source Languages: C, FORTRAN 77, Fortran 90/95 (newer Fortran can also be wrapped, but not all
features are supported) Documentation: http://cens.ioc.ee/projects/f2py2e/usersguide/index.html</pre>
</div>
<p>F2PY automates the process of generating a library that contains Fortran functions
callable from Python as well as an interface into exposed common blocks and Fortran
90/95 module data. Additionally, F2PY handles the conversion of inputs and outputs
between their representative Python and Fortran types,  particularly with arrays,
which are converted into NumPy&#8217;s numerical arrays on the Python side. The most
attractive feature of F2PY is its simplicity &#8211; it can be learned quickly and used
without understanding the details under the hood.</p>
<p>While F2PY was developed for use with Fortran, it can also wrap C functions with almost as
much ease. An example of wrapping a C function with F2PY can be found in <a class="reference internal" href="../tutorials/complex/external_module.html#wrapping-an-external-module-using-f2py"><em>Wrapping an External Module Using F2PY</em></a>
in the OpenMDAO Tutorial.</p>
<p>To illustrate the creation of an OpenMDAO component from a Fortran function, we&#8217;ll present a brief
tutorial. The following instructions will help you locate the directory containing the pieces
needed for the model relative to the install directory:</p>
<p>If you have downloaded the latest release version from the website, you should find the files you need here:</p>
<div class="highlight-python"><pre>openmdao-X.X.X/lib/python2.7/site-packages/openmdao.examples.bar3simulation-X.X.X-######.egg/openmdao/examples/bar3simulation</pre>
</div>
<p><tt class="docutils literal"><span class="pre">X.X.X</span></tt> is the current OpenMDAO version, and <tt class="docutils literal"><span class="pre">######</span></tt> is a string that contains the Python version and the
Operating System description. This path will vary depending on your system and version, but there will be
only one <tt class="docutils literal"><span class="pre">bar3simulation</span></tt> in your distribution.</p>
<p>If you are a developer and have a branch from the source repository, you will find the files you need here:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">examples</span><span class="o">/</span><span class="n">openmdao</span><span class="o">.</span><span class="n">examples</span><span class="o">.</span><span class="n">bar3simulation</span><span class="o">/</span><span class="n">openmdao</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">bar3simulation</span>
</pre></div>
</div>
<p>Note that a Fortran compiler is required. The instructions presented here are
applicable to the UNIX and Mac OS X environments. There may be some differences on the Windows
platform.</p>
<p id="index-6">The Fortran code <tt class="docutils literal"><span class="pre">bar3.f</span></tt> contains the subroutine <tt class="docutils literal"><span class="pre">runbar3truss</span></tt>, which contains an analytical solution
for a three-bar truss with the following specific geometry:</p>
<div class="figure align-center">
<img alt="Lines and errors showing the geometry of the 3-bar truss" src="../_images/ThreeBar.jpg" />
<p class="caption">The 3-Bar Truss Geometry</p>
</div>
<p>The inputs to the problem are the components of the body force acting on node 1 (2d array <em>pvec</em>);
the initial cross-sectional areas of all three structural elements (<em>a1, a2, a3</em>); the lumped mass
at node 1 (<em>mo</em>); the length of bar 2 (<em>el</em>, this essentially scales the problem); and some
material properties for the  bars (<em>e</em>, Young&#8217;s Modulus, and <em>rho</em>, material density). The outputs of
interest are the stresses  in each bar (<em>s1, s2, s3</em>); the displacement at node 1 (<em>u, v</em>); the
frequency of the first mode of vibration (<em>ff</em>); and the total weight of the structure (<em>obj</em>). The
objective of this example is to use this Fortran subroutine to calculate the optimal
cross-sectional areas of the three bars that minimize the total weight of the structure while
satisfying constraints on the bar stresses, the displacement of node 1, and the frequency of the
first mode.</p>
<p>The <a class="reference external" href="http://cens.ioc.ee/projects/f2py2e/usersguide/index.html">F2PY Users Guide</a> describes three
ways to use F2PY to generate the Python-callable object. The &#8220;quick way&#8221; is to just run F2PY on the
Fortran file, which produces a shared object containing a function (or functions) that can be
called from Python. This works for the simplest case but breaks down when F2PY doesn&#8217;t know which
function arguments are inputs and which are outputs. In the &#8220;smart way,&#8221; the user specifies the
input/output intent of each function in the signature file (extension <tt class="docutils literal"><span class="pre">.pyf</span></tt>). Finally, in the
&#8220;quick and smart way,&#8221; the input/output intents are specified directly in the Fortran code as
comments.</p>
<p>This example showcases the &#8220;quick and smart way.&#8221; An example of the &#8220;smart way&#8221; can be found in
<a class="reference internal" href="../tutorials/complex/external_module.html#wrapping-an-external-module-using-f2py"><em>Wrapping an External Module Using F2PY</em></a>, where a signature file is included
as part of the engine design tutorial. The &#8220;quick and smart way&#8221; should be fine for most cases,
provided there are no objections to inserting new comments into your existing source code. For
some cases, the extra flexibility of the signature file may be needed. One specific example
is where you only want to expose one function from a Fortran file that contains
several functions. In this case you can instruct F2PY to generate a signature file,
after which you can edit it to your satisfaction.</p>
<p>Subroutine <tt class="docutils literal"><span class="pre">runbar3truss</span></tt> has the following interface:</p>
<div class="highlight-python"><pre> SUBROUTINE runbar3truss(PVEC,M0,A1,A2,A3,E,EL,RHO,
*                        S1,S2,S3,U,V,FF,OBJ)</pre>
</div>
<p>The inputs and outputs are described above. To tell F2PY which of these variables are
inputs and which are outputs, a series of comments is inserted after the function header. These
comments are prefaced with <tt class="docutils literal"><span class="pre">Cf2py</span></tt>:</p>
<div class="highlight-python"><pre>      ...
      Double Precision S1, S2, S3
      Double Precision U, V, FF
      Double Precision obj

Cf2py intent(in) pvec
Cf2py intent(in) mo
Cf2py intent(in) a1
Cf2py intent(in) a2
Cf2py intent(in) a3
Cf2py intent(in) e
Cf2py intent(in) el
Cf2py intent(in) rho
Cf2py intent(out) s1
Cf2py intent(out) s2
Cf2py intent(out) s3
Cf2py intent(out) u
Cf2py intent(out) v
Cf2py intent(out) ff
Cf2py intent(out) obj</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">intent(in)</span></tt> marks an input, and <tt class="docutils literal"><span class="pre">intent(out)</span></tt> denotes an output. If an argument serves as
both an input and output (i.e., it passes a value to the argument and expects a change
upon completion), then <tt class="docutils literal"><span class="pre">intent(inout)</span></tt> can be used. There are several other intents that are
useful for other less common cases. One that may be of interest is <tt class="docutils literal"><span class="pre">intent(callback)</span></tt>, which
can be used to pass a Python (or other) function into a Fortran subroutine.</p>
<p>Once the intents have all been declared, F2PY can be executed to produce the module by
executing the following at the command prompt:</p>
<div class="highlight-python"><pre>[unix_prompt]$ f2py -c -m bar3 bar3.f</pre>
</div>
<p>The result is the shared object <tt class="docutils literal"><span class="pre">bar3.so.</span></tt> The next step is to build a Python component that
can run <tt class="docutils literal"><span class="pre">runbar3truss</span></tt>, supplying its inputs and gathering its output. An OpenMDAO wrapper
for <tt class="docutils literal"><span class="pre">bar3.so</span></tt> is available as part of this example and can be found in <tt class="docutils literal"><span class="pre">bar3_wrap_f.py</span></tt>. The
functions that were compiled through F2PY are contained in the bar3 library, and this can
be imported into Python just like any Python file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">openmdao.examples.bar3simulation.bar3</span> <span class="kn">import</span> <span class="n">runbar3truss</span><span class="p">,</span> <span class="n">forces</span>
</pre></div>
</div>
<p>Here, we import both the function <tt class="docutils literal"><span class="pre">runbar3truss</span></tt> and the common block
<em>forces</em>. Calling into this function is similar to calling a Python function.
Inputs are passed in as arguments, and outputs are returned on the right-hand
side.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Call the Fortran model and pass it what it needs.</span>

<span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bar1_stress</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bar2_stress</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bar3_stress</span><span class="p">,</span>
 <span class="bp">self</span><span class="o">.</span><span class="n">displacement_x_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">displacement_y_dir</span><span class="p">,</span>
 <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span> \
 <span class="o">=</span> <span class="n">runbar3truss</span><span class="p">(</span>
            <span class="n">load</span><span class="p">,</span> <span class="n">lumped_mass</span><span class="p">,</span>
            <span class="n">bar1_area</span><span class="p">,</span><span class="n">bar2_area</span><span class="p">,</span><span class="n">bar3_area</span><span class="p">,</span>
            <span class="n">Youngs_Modulus</span><span class="p">,</span> <span class="n">bar2_length</span><span class="p">,</span> <span class="n">weight_density</span><span class="p">)</span>
</pre></div>
</div>
<p>F2PY automatically generates a docstring for this function. This can be examined by
opening OpenMDAO&#8217;s local Python environment:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">openmdao.examples.bar3simulation.bar3</span> <span class="kn">import</span> <span class="n">runbar3truss</span><span class="p">,</span> <span class="n">forces</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">runbar3truss</span><span class="o">.</span><span class="n">__doc__</span>
<span class="go">runbar3truss - Function signature:</span>
<span class="go">  s1,s2,s3,u,v,ff,obj = runbar3truss(pvec,m0,a1,a2,a3,e,el,rho)</span>
<span class="go">Required arguments:</span>
<span class="go">  pvec : input rank-1 array(&#39;d&#39;) with bounds (2)</span>
<span class="go">  m0 : input float</span>
<span class="go">  a1 : input float</span>
<span class="go">  a2 : input float</span>
<span class="go">  a3 : input float</span>
<span class="go">  e : input float</span>
<span class="go">  el : input float</span>
<span class="go">  rho : input float</span>
<span class="go">Return objects:</span>
<span class="go">  s1 : float</span>
<span class="go">  s2 : float</span>
<span class="go">  s3 : float</span>
<span class="go">  u : float</span>
<span class="go">  v : float</span>
<span class="go">  ff : float</span>
<span class="go">  obj : float</span>
</pre></div>
</div>
<p>The docstring can be useful for figuring out the arguments and returns for the
generated function. Most of the values passed here are floats, which
are analogous to double precision variables in Fortran. The load is stored in
<em>pvec,</em> which is an array that contains the x and y components of the force. To
pass this into the Fortran subroutine, it needs to be in the form of a NumPy
array (in this case, an array of floating point numbers):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">zeros</span>

<span class="n">load</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&#39;d&#39;</span><span class="p">)</span>
<span class="n">load</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">50.0</span>
<span class="n">load</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">100.0</span>
</pre></div>
</div>
<p>By the same token, NumPy arrays should be used to receive arrays that are returned to
Python by the Fortran function.</p>
<p>Data in the common blocks is also accessible. In this case, the Fortran code stores
the values of the bar forces in a common block as <tt class="docutils literal"><span class="pre">force1,</span> <span class="pre">force2,</span></tt> and <tt class="docutils literal"><span class="pre">force3.</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">bar1_force</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">forces</span><span class="o">.</span><span class="n">force1</span><span class="p">)</span>
<span class="n">bar2_force</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">forces</span><span class="o">.</span><span class="n">force2</span><span class="p">)</span>
<span class="n">bar3_force</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">forces</span><span class="o">.</span><span class="n">force3</span><span class="p">)</span>
</pre></div>
</div>
<p>Scalar variables in the common block get returned to Python as a
zero-dimensional NumPy array. Their values can be accessed by casting them as
floats or int. We can also input values into the common block. In practice,
the common block will sometimes be used for passing minor variables without
cluttering the function interface.</p>
<p>Further examples of a more complicated wrap can be seen in the source for the OpenMDAO
wrapper of the CONMIN optimizer (<tt class="docutils literal"><span class="pre">conmindriver.py</span></tt>).</p>
<p>Finally, the OpenMDAO top-level assembly for this problem is given in <tt class="docutils literal"><span class="pre">bar3_optimization.py</span></tt>.
This model integrates the 3-bar truss wrapper and the CONMIN optimizer to solve the full
problem.</p>
<p id="index-7"><strong>F2PY Quick Command Reference</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="51%" />
<col width="49%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Build</th>
<th class="head">Command</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Ordinary Build</td>
<td><tt class="docutils literal"><span class="pre">f2py</span> <span class="pre">-c</span> <span class="pre">-m</span> <span class="pre">foo</span> <span class="pre">foo.f</span></tt></td>
</tr>
<tr class="row-odd"><td>Make Signature File Only</td>
<td><tt class="docutils literal"><span class="pre">f2py</span> <span class="pre">-m</span> <span class="pre">foo</span> <span class="pre">-h</span> <span class="pre">foo.pyf</span> <span class="pre">foo.f</span></tt></td>
</tr>
<tr class="row-even"><td>Build with Signature <tt class="docutils literal"><span class="pre">foo.pyf</span></tt></td>
<td><tt class="docutils literal"><span class="pre">f2py</span> <span class="pre">foo.pyf</span> <span class="pre">foo.f</span> <span class="pre">-c</span></tt></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="creating-an-extension-with-swig">
<span id="index-8"></span><h2>Creating an Extension with SWIG<a class="headerlink" href="#creating-an-extension-with-swig" title="Permalink to this headline">¶</a></h2>
<p>The Simplified Wrapper and Interface Generator (<a class="reference internal" href="../glossary.html#term-swig"><em class="xref std std-term">SWIG</em></a>) is a tool that simplifies the
creation of extensions from C and C++ functions for use in a variety of target languages,
including Python. To use SWIG you must download and
install the most recent version at the system level.</p>
<div class="highlight-python"><pre>Wrapper Utility: SWIG
Source Languages: C, C++
Documentation: http://www.swig.org/doc.html</pre>
</div>
<p>SWIG is a bit more complicated than F2PY, so you are strongly encouraged to read
the documentation and experiment with their <a class="reference external" href="http://www.swig.org/tutorial.html">example problem</a> before
attempting to wrap your own C or C++ codes.</p>
<p>The first step in creating a Python extension is to create the interface file for the C functions
that are to be wrapped. The interface file is analogous to the signature file that F2PY uses, though
its format is more like C. For example, consider the engine simulation as described in the <a class="reference internal" href="../tutorials/complex/index.html#a-more-complex-tutorial-problem"><em>more
complex tutorial</em></a>. There is one function with inputs and outputs
effectively passed as arguments. The corresponding interface file would look like this:</p>
<div class="highlight-python"><pre>/* engineC_SWIG.i */

%module engineC_SWIG_wrap

%{
    /* Put header files here or function declarations like below */
     void RunEngineCycle(double stroke, double bore, double conrod, double compRatio, double sparkAngle,
                      int nCyl, double IVO, double IVC, double Liv, double Div, double k,
                      double R, double Ru, double Hu, double Tw, double AFR, double Pexth,
                      double Tamb, double Pamb, double Air_Density, double MwAir, double MwFuel,
                      double RPM, double Throttle, double thetastep, double Fuel_Density,
                      double *Power, double *Torque, double *FuelBurn, double *EngineWeight);
%}

void RunEngineCycle(double stroke, double bore, double conrod, double compRatio, double sparkAngle,
                    int nCyl, double IVO, double IVC, double Liv, double Div, double k,
                    double R, double Ru, double Hu, double Tw, double AFR, double Pexth,
                    double Tamb, double Pamb, double Air_Density, double MwAir, double MwFuel,
                    double RPM, double Throttle, double thetastep, double Fuel_Density,
                    double *OUTPUT, double *OUTPUT, double *OUTPUT, double *OUTPUT);</pre>
</div>
<p>Notice that the variables <cite>Power, Torque, FuelBurn,</cite> and <cite>EngineWeight</cite> are
declared as outputs. Inputs don&#8217;t have to be explicitly declared, although the keyword <tt class="docutils literal"><span class="pre">INPUT</span></tt>
should be used whenever a pointer is actually a single input value. If a variable
functions as both an input and an output, use the keyword <tt class="docutils literal"><span class="pre">BOTH</span></tt> in the interface file.</p>
<p>Generating the importable shared object from this interface is a 4-step process.</p>
<ol class="arabic simple">
<li>Run SWIG on the interface file, using Python as the target.</li>
<li>Compile the original C function on your system. (Not needed if you already have a library that contains this function.)</li>
<li>Compile the code generated in Step 1.</li>
<li>Link the libraries from steps 2 and 3 (along with any other required externals) to create the shared object.</li>
</ol>
<p>For the engine example, on a UNIX environment with GCC as the compiler, these
steps look like this:</p>
<div class="highlight-python"><pre>swig -python engineC_SWIG.i

gcc -fPIC -c engineC.c -I/usr/local/include/python2.7
gcc -fPIC -c engineC_SWIG_wrap.c -I/usr/local/include/python2.7

gcc -shared engineC.o engineC_SWIG_wrap.o -lGLU -lGL -lX11 -lXext -lpthread /usr/lib64/libstdc++.so.6 -lm -o _engineC_SWIG_wrap.so</pre>
</div>
<p>One common mistake is to give the interface file and the shared object the same name.
Python must be able to import them independently, so name collision should
be avoided (i.e., <tt class="docutils literal"><span class="pre">z.py</span></tt> and <tt class="docutils literal"><span class="pre">z.so</span></tt> in the same namespace). In this case, an
underscore was prepended to the name of the shared object in the link command
to avoid this problem.</p>
<p>On the Python side, interaction with this object differs little from the one we
created with F2PY:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">engineC_SWIG_wrap</span> <span class="kn">import</span> <span class="n">RunEngineCycle</span>
<span class="o">...</span>
<span class="c"># Call the C model and pass it what it needs.</span>

<span class="p">(</span><span class="n">power</span><span class="p">,</span> <span class="n">torque</span><span class="p">,</span> <span class="n">fuel_burn</span><span class="p">,</span> <span class="n">engine_weight</span><span class="p">)</span> <span class="o">=</span> <span class="n">RunEngineCycle</span><span class="p">(</span>
            <span class="n">stroke</span><span class="p">,</span> <span class="n">bore</span><span class="p">,</span> <span class="n">conrod</span><span class="p">,</span> <span class="n">comp_ratio</span><span class="p">,</span> <span class="n">spark_angle</span><span class="p">,</span>
            <span class="n">n_cyl</span><span class="p">,</span> <span class="n">IVO</span><span class="p">,</span> <span class="n">IVC</span><span class="p">,</span> <span class="n">L_v</span><span class="p">,</span> <span class="n">D_v</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span>
            <span class="n">R</span><span class="p">,</span> <span class="n">Ru</span><span class="p">,</span> <span class="n">Hu</span><span class="p">,</span> <span class="n">Tw</span><span class="p">,</span> <span class="n">AFR</span><span class="p">,</span> <span class="n">P_exth</span><span class="p">,</span>
            <span class="n">T_amb</span><span class="p">,</span> <span class="n">P_amb</span><span class="p">,</span> <span class="n">air_density</span><span class="p">,</span> <span class="n">mw_air</span><span class="p">,</span> <span class="n">mw_fuel</span><span class="p">,</span>
            <span class="n">RPM</span><span class="p">,</span> <span class="n">throttle</span><span class="p">,</span> <span class="n">thetastep</span><span class="p">,</span> <span class="n">fuel_density</span><span class="p">)</span>

<span class="c"># Interrogate results of engine simulation and store.</span>

<span class="bp">self</span><span class="o">.</span><span class="n">power</span> <span class="o">=</span> <span class="n">power</span>
<span class="bp">self</span><span class="o">.</span><span class="n">torque</span> <span class="o">=</span> <span class="n">torque</span>
<span class="bp">self</span><span class="o">.</span><span class="n">fuel_burn</span> <span class="o">=</span> <span class="n">fuel_burn</span>
<span class="bp">self</span><span class="o">.</span><span class="n">engine_weight</span> <span class="o">=</span> <span class="n">engine_weight</span>
</pre></div>
</div>
<p>The only difference here is that the outputs are returned as single value
variables instead of the zero-dimensional lists that F2PY returns whenever
it generates the interface for a C function.</p>
<div class="admonition-todo admonition" id="index-9">
<p class="first admonition-title">Todo</p>
<p class="last">C++ Example</p>
</div>
<div class="admonition-todo admonition" id="index-10">
<p class="first admonition-title">Todo</p>
<p class="last">SWIG helpful hints</p>
</div>
</div>
<div class="section" id="creating-an-extension-with-jcc">
<h2>Creating an Extension with JCC<a class="headerlink" href="#creating-an-extension-with-jcc" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>Wrapper Utility: JCC
Source Languages: Java
Documentation: http://pypi.python.org/pypi/JCC/1.5</pre>
</div>
<div class="admonition-todo admonition" id="index-11">
<p class="first admonition-title">Todo</p>
<p class="last">Java Example</p>
</div>
</div>
<div class="section" id="creating-an-extension-using-python-s-ctypes">
<h2>Creating an Extension using Python&#8217;s ctypes<a class="headerlink" href="#creating-an-extension-using-python-s-ctypes" title="Permalink to this headline">¶</a></h2>
<div class="admonition-todo admonition" id="index-12">
<p class="first admonition-title">Todo</p>
<p class="last">Example wrap for an existing C dynamic link library</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<a href="http://openmdao.org">
 <img src="../_static/OpenMDAO_Logo_200w_padded.png"
border="0" alt="OpenMDAO Home"/>
</a>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Building a Plugin that Contains a Python Extension</a><ul>
<li><a class="reference internal" href="#creating-an-extension-with-f2py">Creating an Extension with F2PY</a></li>
<li><a class="reference internal" href="#creating-an-extension-with-swig">Creating an Extension with SWIG</a></li>
<li><a class="reference internal" href="#creating-an-extension-with-jcc">Creating an Extension with JCC</a></li>
<li><a class="reference internal" href="#creating-an-extension-using-python-s-ctypes">Creating an Extension using Python&#8217;s ctypes</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="variable_plugin.html"
                        title="previous chapter">Building a Variable Plugin</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="filewrapper_plugin.html"
                        title="next chapter">Building a Plugin that Contains a File Wrapper</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/plugin-guide/extension_plugin.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="filewrapper_plugin.html" title="Building a Plugin that Contains a File Wrapper"
             >next</a> |</li>
        <li class="right" >
          <a href="variable_plugin.html" title="Building a Variable Plugin"
             >previous</a> |</li>
  <li><a href="http://openmdao.org">OpenMDAO Home</a> &raquo;</li>
  
        <li><a href="../index.html">OpenMDAO Documentation v0.8.1</a> &raquo;</li>

          <li><a href="index.html" >Plugin Developer Guide</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright none.
      Last updated on Aug 26, 2013.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>