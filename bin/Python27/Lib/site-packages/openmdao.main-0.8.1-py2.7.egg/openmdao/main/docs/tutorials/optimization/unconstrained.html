
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Building a Model - Unconstrained Optimization &mdash; OpenMDAO Documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.8.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="OpenMDAO Documentation" href="../../index.html" />
    <link rel="up" title="Simple Optimization" href="index.html" />
    <link rel="next" title="Building a Model - Constrained Optimization" href="constrained.html" />
    <link rel="prev" title="Overview" href="overview.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="constrained.html" title="Building a Model - Constrained Optimization"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="overview.html" title="Overview"
             accesskey="P">previous</a> |</li>
  <li><a href="http://openmdao.org">OpenMDAO Home</a> &raquo;</li>
  
        <li><a href="../../index.html">OpenMDAO Documentation v0.8.1</a> &raquo;</li>

          <li><a href="../index.html" >OpenMDAO Tutorials</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Simple Optimization</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="building-a-model-unconstrained-optimization">
<span id="using-conmin"></span><span id="index-0"></span><h1>Building a Model - Unconstrained Optimization<a class="headerlink" href="#building-a-model-unconstrained-optimization" title="Permalink to this headline">¶</a></h1>
<p>Your next task is to build a model that finds the minimum value for the Paraboloid component.
This model contains the Paraboloid as well as a gradient optimizer
called <a class="reference internal" href="../../glossary.html#term-conmin"><em class="xref std std-term">CONMIN</em></a>, from the OpenMDAO standard library.
Create a file called <tt class="docutils literal"><span class="pre">optimization_unconstrained.py</span></tt> and copy this
block of code into it.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">openmdao.main.api</span> <span class="kn">import</span> <span class="n">Assembly</span>
<span class="kn">from</span> <span class="nn">openmdao.lib.drivers.api</span> <span class="kn">import</span> <span class="n">SLSQPdriver</span>
<span class="kn">from</span> <span class="nn">openmdao.examples.simple.paraboloid</span> <span class="kn">import</span> <span class="n">Paraboloid</span>

<span class="k">class</span> <span class="nc">OptimizationUnconstrained</span><span class="p">(</span><span class="n">Assembly</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Unconstrained optimization of the Paraboloid Component.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c"># Create Optimizer instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;driver&#39;</span><span class="p">,</span> <span class="n">SLSQPdriver</span><span class="p">())</span>

        <span class="c"># Create Paraboloid component instances</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;paraboloid&#39;</span><span class="p">,</span> <span class="n">Paraboloid</span><span class="p">())</span>

        <span class="c"># Driver process definition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;paraboloid&#39;</span><span class="p">)</span>

        <span class="c"># SLSQP Flags</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">iprint</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c"># Objective</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span><span class="s">&#39;paraboloid.f_xy&#39;</span><span class="p">)</span>

        <span class="c"># Design Variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s">&#39;paraboloid.x&#39;</span><span class="p">,</span> <span class="n">low</span><span class="o">=-</span><span class="mf">50.</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">50.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s">&#39;paraboloid.y&#39;</span><span class="p">,</span> <span class="n">low</span><span class="o">=-</span><span class="mf">50.</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">50.</span><span class="p">)</span>
</pre></div>
</div>
<p id="index-1">An <a class="reference internal" href="../../glossary.html#term-assembly"><em class="xref std std-term">Assembly</em></a> is a container that can hold any number of components, drivers, and other
assemblies. An Assembly also manages the connections between the components that it
contains. In this problem the assembly includes a single
Paraboloid component and a SLSQPdriver named <em>driver</em>. The name <em>driver</em> is special. When an
assembly is executed, it looks for a Driver named <em>driver</em> and executes it. The
OptimizationUnconstrained class is derived from Assembly.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">OptimizationUnconstrained</span><span class="p">(</span><span class="n">Assembly</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Unconstrained optimization of the Paraboloid with CONMIN.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;function that sets up the architecture&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>In the Paraboloid component, you created an <tt class="docutils literal"><span class="pre">execute</span></tt> function to tell it what to do when the
component is run. Assemblies don&#8217;t need an <tt class="docutils literal"><span class="pre">execute</span></tt> function, since they don&#8217;t really do any
calculations of their own. Instead the assembly has a <tt class="docutils literal"><span class="pre">configure</span></tt> function defined
that manages the creation of all the components, drivers, and data connections.</p>
<p>When configuring you use the <tt class="docutils literal"><span class="pre">add</span></tt> function to put things into the assembly:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Create Optimizer instance</span>
<span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;driver&#39;</span><span class="p">,</span> <span class="n">SLSQPdriver</span><span class="p">())</span>

<span class="c"># Create Paraboloid component instances</span>
<span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;paraboloid&#39;</span><span class="p">,</span> <span class="n">Paraboloid</span><span class="p">())</span>
</pre></div>
</div>
<p>Here you will make an instance of the <em>Paraboloid</em> component that you created above and
give it the name <em>paraboloid.</em> Similarly you will create an instance of SLSQPdriver and
give it the name <em>driver</em>. These are now accessible in the <tt class="docutils literal"><span class="pre">OptimizationUnconstrained</span></tt> assembly
via <tt class="docutils literal"><span class="pre">self.paraboloid</span></tt> and <tt class="docutils literal"><span class="pre">self.driver</span></tt>. Remember, assemblies always look for the Driver called <tt class="docutils literal"><span class="pre">driver</span></tt> to run the
model.</p>
<p>Next, <em>driver</em> needs to be told what to run. Every driver has a <a class="reference internal" href="../../glossary.html#term-workflow"><em class="xref std std-term">Workflow</em></a>
that contains a list of the components that the driver tells to run. We can add the
<em>paraboloid</em> component to the driver&#8217;s workflow by using its <tt class="docutils literal"><span class="pre">add</span></tt> function.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Iteration Hierarchy</span>
<span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;paraboloid&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>For this problem, you want to minimize <tt class="docutils literal"><span class="pre">f_xy</span></tt>. In optimization, this is called
the <em>objective function</em>. In OpenMDAO, you define the <tt class="docutils literal"><span class="pre">objective</span></tt> function by
calling the driver&#8217;s <tt class="docutils literal"><span class="pre">add_objective</span></tt> function.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Objective</span>
<span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span><span class="s">&#39;paraboloid.f_xy&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Every variable has a unique name in the OpenMDAO data hierarchy. This
name combines the variable name with its parents&#8217; names. You can think
of it as something similar to the path name in a file system, but it uses a &#8221;.&#8221;
as a separator. This allows two components to have the same variable name
while assuring that you can still refer to each of them uniquely. Here, the
<tt class="docutils literal"><span class="pre">f_xy</span></tt> output of the Paraboloid component is selected as the objective for
minimization by specifying its full name, <tt class="docutils literal"><span class="pre">paraboloid.f_xy</span></tt>.</p>
<p>To find the minimum value of the objective function, we want to optimizer to
vary the <cite>x</cite> and <cite>y</cite> variables. The design variables are declared
individually using the <tt class="docutils literal"><span class="pre">add_parameter</span></tt> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Design Variables</span>
<span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s">&#39;paraboloid.x&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s">&#39;paraboloid.y&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
<p>Once again, you specify the parameters with the full name of each variable: <tt class="docutils literal"><span class="pre">paraboloid.x</span></tt>
and <tt class="docutils literal"><span class="pre">paraboloid.y</span></tt>. The <tt class="docutils literal"><span class="pre">add_parameter</span></tt> method also allows you to add a range of
validity for these variables so that the unconstrained optimization can be
performed on a bounded region. For this problem, you are constraining <cite>x</cite> and <cite>y</cite>
to lie between <tt class="docutils literal"><span class="pre">[-50,</span> <span class="pre">50]</span></tt>.</p>
<p>The problem is now essentially ready to execute. We&#8217;re just going to set
the optimizer&#8217;s verbosity to a minimum. You can turn it up if you want more
information about whats going on.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># SQLSQP Flags</span>
<span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">iprint</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Congratulations! You just built your first model in OpenMDAO. Now let&#8217;s run it.</p>
<div class="section" id="executing-the-simple-optimization-problem">
<h2>Executing the Simple Optimization Problem<a class="headerlink" href="#executing-the-simple-optimization-problem" title="Permalink to this headline">¶</a></h2>
<p>To run your model, you need to create an instance of <tt class="docutils literal"><span class="pre">OptimizationUnconstrained</span></tt> and tell it to run.</p>
<p>To do this, we&#8217;re going to add some code to the end of the <tt class="docutils literal"><span class="pre">optimization_unconstrained.py</span></tt> so that
it can be executed in Python.  Using the conditional <tt class="docutils literal"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">&quot;__main__&quot;:</span></tt> you can include
some Python code at the bottom  of <tt class="docutils literal"><span class="pre">optimization_unconstrained.py</span></tt>. This allows you to run the
file but also lets you import your assembly into another model without running it. So the final
lines in this file are:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="n">opt_problem</span> <span class="o">=</span> <span class="n">OptimizationUnconstrained</span><span class="p">()</span>

    <span class="kn">import</span> <span class="nn">time</span>
    <span class="n">tt</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="n">opt_problem</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
    <span class="k">print</span> <span class="s">&quot;Minimum found at (</span><span class="si">%f</span><span class="s">, </span><span class="si">%f</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">opt_problem</span><span class="o">.</span><span class="n">paraboloid</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> \
                                     <span class="n">opt_problem</span><span class="o">.</span><span class="n">paraboloid</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&quot;Elapsed time: &quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">tt</span><span class="p">,</span> <span class="s">&quot;seconds&quot;</span>
</pre></div>
</div>
<p>In this block of code you are doing four things:</p>
<blockquote>
<div><ol class="arabic simple">
<li>In the first statement, you create an instance of the class <tt class="docutils literal"><span class="pre">OptimizationUnconstrained</span></tt> with
the name <tt class="docutils literal"><span class="pre">opt_problem</span></tt>.</li>
<li>In the second statement, you set <tt class="docutils literal"><span class="pre">opt_problem</span></tt> as the top Assembly in the model hierarchy. (This will be explained in a later tutorial.)</li>
<li>In the fifth statement, you tell <tt class="docutils literal"><span class="pre">opt_problem</span></tt> to run. (The model will execute until the optimizer&#8217;s
termination criteria are reached.)</li>
<li>In the remaining statements, you define the results to print, including the elapsed time.</li>
</ol>
</div></blockquote>
<p>Add the above code into your <tt class="docutils literal"><span class="pre">optimization_unconstrained.py</span></tt> file and save it.
Then type the following at the command prompt:</p>
<div class="highlight-python"><pre>python optimization_unconstrained.py</pre>
</div>
<p>This should produce the output:</p>
<div class="highlight-python"><pre>Minimum found at (6.666309, -7.333026)
Elapsed time:  0.0558300018311 seconds</pre>
</div>
<p>Now you are ready to solve a more advanced optimization problem with constraints.</p>
</div>
<div class="section" id="debugging-via-log-messages">
<h2>Debugging Via Log Messages<a class="headerlink" href="#debugging-via-log-messages" title="Permalink to this headline">¶</a></h2>
<p>You may have noticed that a file with a name of the form
<tt class="docutils literal"><span class="pre">openmdao_log_.txt</span></tt> was created during the above Python run.
This file is written using the standard Python logging package.
Many of the OpenMDAO modules will write to the log file to record errors,
warnings, debugging information, etc.  The format of the message is:</p>
<div class="highlight-python"><pre>timestamp loglevel source: message</pre>
</div>
<p>By default, only warnings (<tt class="docutils literal"><span class="pre">W</span></tt>) and errors (<tt class="docutils literal"><span class="pre">E</span></tt>) are written to the log
file.  If you want more information printed, you can use the standard logging
level control on the root logger:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</pre></div>
</div>
<p>This is a global enabling control of all messages.  If you find that messages
from a particular component need to be throttled somewhat, you can change the
logging level for that component:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">opt_problem</span><span class="o">.</span><span class="n">paraboloid</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>
</pre></div>
</div>
<p>If you would like to have the log messages printed on the console, you can
include this in your main routine:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">openmdao.main.api</span> <span class="kn">import</span> <span class="n">enable_console</span>
<span class="n">enable_console</span><span class="p">()</span>
</pre></div>
</div>
<p>Console log messages do not have timestamps.</p>
<p>Now the existing Paraboloid component does not do any logging beyond that
of Component.  You can either modify Paraboloid to add log messages
or make a derived class:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TracingParaboloid</span><span class="p">(</span><span class="n">Paraboloid</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;execute x=</span><span class="si">%g</span><span class="s">, y=</span><span class="si">%g</span><span class="s">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TracingParaboloid</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;    result=</span><span class="si">%g</span><span class="s">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_xy</span><span class="p">)</span>
</pre></div>
</div>
<p>Of course, if you make a derived class, you need to change your model to use
that class rather than the original.</p>
<p>One final note about logging: if you have a distributed simulation, log messages
from remote servers are automatically routed back to the client.  In this case
the message includes the source server in square brackets:</p>
<div class="highlight-python"><pre>timestamp loglevel [server] source: message</pre>
</div>
<p>You can remotely control the server&#8217;s logging level via the server&#8217;s
<tt class="xref py py-meth docutils literal"><span class="pre">set_log_level()</span></tt>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<a href="http://openmdao.org">
 <img src="../../_static/OpenMDAO_Logo_200w_padded.png"
border="0" alt="OpenMDAO Home"/>
</a>

  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Building a Model - Unconstrained Optimization</a><ul>
<li><a class="reference internal" href="#executing-the-simple-optimization-problem">Executing the Simple Optimization Problem</a></li>
<li><a class="reference internal" href="#debugging-via-log-messages">Debugging Via Log Messages</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="overview.html"
                        title="previous chapter">Overview</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="constrained.html"
                        title="next chapter">Building a Model - Constrained Optimization</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/tutorials/optimization/unconstrained.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="constrained.html" title="Building a Model - Constrained Optimization"
             >next</a> |</li>
        <li class="right" >
          <a href="overview.html" title="Overview"
             >previous</a> |</li>
  <li><a href="http://openmdao.org">OpenMDAO Home</a> &raquo;</li>
  
        <li><a href="../../index.html">OpenMDAO Documentation v0.8.1</a> &raquo;</li>

          <li><a href="../index.html" >OpenMDAO Tutorials</a> &raquo;</li>
          <li><a href="index.html" >Simple Optimization</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright none.
      Last updated on Aug 26, 2013.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>